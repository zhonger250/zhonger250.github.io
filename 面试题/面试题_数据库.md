# 数据库

### 1.事务的特性:

#### 原子性(Atomicity):
事务中的所有操作要么全部执行，要么全都不执行。如果事务没有原子性的保证，那么在发生系统故障的情况下，数据库就有可能处于不一致状态。

#### 一致性(Consistency):
主要强调的是，如果在执行事务之前数据库是一致的，那么在执行事务之后数据库也还是一致的。所谓一致性简单地说就是数据库中数据的完整性，包括它们的正确性。

#### 隔离性(Isolation):
即使多个事务并发（同时）执行，每个事务都感觉不到系统中有其他的事务在执行，因而也就能保证数据库的一致性。

#### 持久性(Durability):
事务成功执行后它对数据库的修改是永久的，即使系统出现故障也不受影响。

### 2.数据库的隔离级别有哪些？

#### 读未提交:
会产生:脏读 不可重复读 幻读等问题。
当数据库系统使用读未提交(READ UNCOMMITTED)隔离级别时，一个事务在执行过程中可以看到其他事务没有提交的新插入的记录和更新的记录。

#### 读已提交:
会产生:不可重复读 幻读等问题。
当数据库系统使用读已提交(READ COMMITTED)隔离级别时，一个事务在执行过程中能看到其他事务已经提交的新增和更新的记录。

#### 可重复读:
会产生:幻读
当数据库系统使用可重复读(REPEATABLE READ)隔离级别时，一个事务在执行过程中不能看到其他事务未提交的更新的记录,但是可以看到其他事务已经提交的新增的记录。MySQL数据库的隔离级别是可重复读。但是MySQL的可重复读不会出现幻读。

#### 串行化:
数据库系统使用串行化(SERIALIZABLE)隔离级别时，一个事务在执行过程中完全看不到其他事务对数据库所做的更新。当两个事务同时操作数据库中相同数据时，如果第一个事务已经在访问该数据，第二个事务只能停下来等待，必须等到第一个事务结束后才能恢复运行。因此这两个事务实际上是串行化方式运行。


### 3.隔离级别产生的问题

#### 脏写：
事务B去修改了事务A修改过的值，但是此时事务A还没提交，事务A会回滚, 导致事务B修改的值也没了,这就是脏写。

#### 脏读：
事务B去查询了事务A修改过的数据，但是此时事务A还没提交，事务A回滚导致事务B再次查询就读不到刚才事务A修改的数据,这就是脏读。

#### 不可重复读：
假设缓存页里一条数据原来的值是A值，此时事务A开启之后，第一次查询这条数据，读取到的就是A值。接着事务B更新了那行数据的值为B值，同时事务B立马提交。然后事务A此时可是还没提交，他在事务执行期间第二次查询数据，此时查到的是事务B修改过的B值，因为事务B已经提交了，所以事务A可以读到最新的值。紧接着事务C再次更新数据为C值，并且提交事务了，此时事务A在没提交的情况下，第三次查询数据，查到的值为C值。可能是一个问题也可能不是一个问题,看看程序具体的要求,是允许不可重复读还是允许重复读。

#### 幻读：
幻读指的就是一个事务用一样的SQL语句多次查询，结果每次查询都会发现查到了一些之前没看到过的数据。注意，幻读特指的是你查询到了之前查询没看到过的数据!此时就说你是幻读了。

### 4.数据库设计的三大范式

#### 第一范式(确保每列保持原子性) :
第一范式是最基本的范式。如果数据库表中的所有字段值都是不可分解的原子值,就说明该数据库表满足了第一范式。

#### 第二范式:
在第一范式的基础之上更进一层。第二范式需要确保数据库表中的每一列都和主键相关。就是说在一个数据库表中，一个表中只能保存一种数据，不可以把多种数据保存在同一张数据库表中。

#### 第三范式:
需要确保数据表中的每一列数据都和主键直接相关，而不能间接相关。

### 5.MySQL存储引擎有哪些

#### MYISAM：
拥有较高的执行速度，不支持事务，不支持外键，并发性能差，占用空间相对较小，对事务完整性没有要求。

#### Innodb:
行级锁，提供了具有提交、回滚和崩溃恢复能力的事务安全，支持自动增长列，支持外键约束，并发能力强。

#### Memory:
存储在内存中，速度快，但会占用和数据量成正比的内存空间且数据在mysql重启时会丢失，默认使用HASH索引，检索效率非常高，但不适用于精确查找，主要用于那些内容变化不频繁的代码表

### 6.什么是MVCC机制
MVCC 是一种并发控制的方法，实现对数据库的并发访问，以提高并发性能。MVCC主要用到了Undo Log链和Read View数据结构。在数据修改之前会把数据拷贝一份到undo log，每条undo_log数据都有两个隐藏字段,一个是DB_TRX_ID 表示最近一次更新这条数据的事务ID。一个是DB_ROLL_PTR 指向更新这条数据之前生成的undo lock数据。

在数据库隔离级别是读已提交,每次执行查询的时候都会创建ReadView。隔离级别是可重复读，仅在第一次查询的时候生成ReadView，后续复用此ReadView。

ReadView 包括四个字段m_ids 当前活跃的事务编号。min_trx_id:最小活跃事务编号。max_trx_id:预分配事务编号，当前最大事务编号+1。creator_trx_id:ReadeView创建者的事务编号。
